# 四年匠心打磨，Nervos 为区块链镶上璀璨明珠 — — Fiber Network 轻皮书解读

闪电网络技术解决了区块链的交易拥堵和高手续费问题，允许用户进行快速、低成本的交易，让区块链技术的大规模应用成为可能。在过去的多年时间里，无数开发者在这一赛道上倾注了大量心血。上周，CKB 发布 “下一代闪电网络” [**Fiber Network 轻皮书**](http://mp.weixin.qq.com/s?__biz=MzkwODI2ODg4Mw%3D%3D&mid=2247492621&idx=1&sn=46d4fb2a855ef9249c2fb4e7be92bede&chksm=c0ce2031f7b9a927f407354be2b08fe7f5e681900ad0ca3264550233165e20c9a716406dfe19&scene=21#wechat_redirect)，这一技术为 RGB++ 资产提供了快速、低成本和去中心化的多币种支付和点对点交易解决方案，展示了团队卓越的技术功底。受此利好消息的影响，CKB 应声上涨近 20%，成为市场上耀眼的明星项目。

那么，闪电网络是什么，解决什么问题，Fiber Network 又如何让这一技术落地，请听堡子为大家细细道来。

## **背景**

区块链技术的代表比特币被定义为 “一种点对点电子现金系统”，区块链作为一项金融领域的创新技术，诸多从业者毕生之愿望便是让其金融属性落地，使得比特币不仅能用来买披萨，还能成为日常交易的手段，实现大规模应用（mass adoption）。而区块链技术本身，尤其是最受认可的比特币链在扩展性和交易速度方面面临诸多挑战，简单而言 — — **交易慢、交易贵，**难以满足日常使用的需求。

**1、交易慢（AKA “拓展性问题”）：**主要体现在 “每秒处理的交易量（TPS）” 低和 “打包确认的速度” 慢两件事。

首先，由于区块大小的限制，比特币网络每秒只能处理 7 笔交易，已经被称作 “高吞吐量” 的 Solana 链日均 TPS 也只有区区 1000 笔交易。在现实里被广泛应用的支付网络中，这个数字可谓微不足道。举例而言，银联系统的 TPS 为 24 万笔/秒，而在 2019 年双十一期间，支付宝系统在一秒内处理了 54.4 万笔订单 — — 如果通过比特币网络进行处理，需要 21 个小时才能处理完这一秒的订单量。这样的网络速度根本无法满足实际需求，如果支付宝采用比特币网络进行处理，大概早被骂到了倒闭。

其次，当区块链中的交易被处理完后，还需经历区块打包和确认过程，才能完成一次交易，这在比特币链上一般耗时十分钟，但遇上卡块等情况也可能长达数个小时 — — 试想，当你在超市买了瓶矿泉水刷完卡付完账，必须在店里坐上数个小时，才能听到收银台 “支付宝到账 2 元” 的提示，商家才会放心的让你离开，谁会喜欢这样的支付体验呢？

**2、交易贵：**当同一时间交易过多，交易费用（手续费）便会急剧上升。为了让自己的交易优先被完成，链上往往发生 Gas 大战。例如在前日的 Babylon 质押和上半年减半打符文时，链上费用曾高达 2000 聪/字节，由于高昂的gas，甚至出现了铸造的铭文涨十倍才回本的境况。在生活中，谁会愿意为了一瓶 2 块钱的矿泉水，支付 20 元的手续费？更别提手续费还受到全链活动的影响，万一遇上 Babylon 等热门应用上线，你的交易可能被无限期推迟，这显然难以接受。

[](https://miro.medium.com/v2/resize:fit:1400/0*vI_tt46nPbcY_3qZ)

通过这瓶 2 元的矿泉水，相信大家已经基本了解了区块链、尤其是比特币链在实现广泛应用上的问题，接下来我们看看，闪电网络如何解决这些问题。

## **闪电网络**

闪电网络主要通过三种方式解决这一问题：

**1、记账（AKA “支付通道”）：**闪电网络通过创建 “支付通道” 的方式，允许交易在不做链上结算的情况下完成，在通道关闭时一次性结算。类似于生活中的 “记账” 或 “赊账” 方式。回到上文中的那家超市，为了解决单笔手续费高、结算慢的问题，商家可以为你开设一本账本，记下你们的每一笔交易，一个月进行一次结算。在闪电网络中，“支付通道” 扮演账本的角色，而为了避免出现逃单的情况，当建立通道时，需要双方各自锁定一部分资金（商家确认你卡里有钱不会跑路，你确认商家店里有货不会倒闭）。

**2、中间人（AKA “多跳路由”）：**在上述例子中，假如你外地的朋友来做客，也想去同一家店买一瓶水，让超市为他这一次交易单独开设创建一本账本显然不划算。如果你们二人经济往来较多，也有自己的账本，就可以通过你作为中间人向超市购买一瓶水。在闪电网络中，“路由” 扮演中间人，而 “多跳路由” 意味着可以有多个中间人完成一笔交易。

**3、货到付款（AKA “哈希时间锁合约（HTLC）”）：**在多人交易中，闪电网络通过 HTLC 保证交易的安全，这可以理解为一个网购中 “三方托管，货到付款” 的过程。当买家下单时，钱被锁定在支付宝中，并创建了一个 “X 日内物流显示货物送到收货地址” 的要求，商家必须满足这一要求才能获得货款，否则买家可以要求退款。在闪电网络中，智能合约扮演支付宝的角色，而 “物流信息” 即为 HTLC 的内容。

P.S. 在实际应用中，双向互相交付的通道还包含双向信息传递以及交互顺序博弈等技术保障安全，多方交互的 HTLC 也包含多种条件，本文仅是对最简单的模型做最基本的抽象。

总结：

1. **通过记账方式，闪电网络解决了交易慢、交易贵的问题；**
2. **通过中间人，闪电网络避免了成本高的问题；**
3. **通过货到付款，闪电网络保障了交易的安全性。**

由此可见，“记账方式” 即 “支付通道的搭建”，是闪电网络解决交易困境的核心，而其他设计则是对闪电网络的进一步优化。因此，在接下来对于 Fiber Network 的介绍中，将重点关注其支付通道的搭建。

# **Fiber Network**

CKB 通过在 Nervos CKB 上构建链外通道，构建了一个快速、低成本和去中心化的多资产实时支付交换网络，包括链下支付通道、链上合约、多跳路由、监控服务四个核心模块。

[](https://miro.medium.com/v2/resize:fit:1400/0*67RiDHZOUkMR_ipn)

## **链下支付通道（Fiber Channels）**

CKB 闪电网络的核心机制，通过在链上创建支付通道，锁定一定数量的 RGB++ 资产。在通道开启期间可以随意进行链下交易，只更新通道状态（记账），不进行链上广播（结算），在任一方关闭通道时，进行链上广播。

最值得注意的是，在 Fiber Network 中，能够流通的是：

1. **BTC 原生资产**
2. **CKB**
3. **RGB++ 原生资产**

这表明，Fiber Channels 不仅让铭文、符文等比特币原生资产（通过接入RGB++ Layer）能够进入闪电网络，CKB 和 Seal、Nervape 等 RGB++ 原生资产也可以进入闪电网络（值得一提的是，以 Seal 为代表的 RGB++ token，或将是首个在闪电网络上直接流通的比特币新协议资产，领先于其他资产进入闪电时代）。甚至，**借助 RGB++ Layer，所有 UTXO 链（ADA、DOGE、LTC 等等）的资产，都可以进入闪电网络，真正实现 “万链归一”，**这样的基建水平全球仅此一家，别无分店。

更重要的是，先前 ccTokens 与 CKB Eco Fund、Meson Finance 合作发行的 1:1 BTC 储备支持的 ccBTC 以及目前已经上线测试网的超额抵押稳定币 RUSD 也同样能够在 Fiber Network 中流通。ccBTC 的流通意味着 BTC 巨鲸的潜在支持（据了解，非常多 BTC OG 只认可闪电网络作为 BTC 二层），而 RUSD 的流通意味着广泛的接受度，不是所有人都愿意接受 CKB、Seal 甚至 BTC，但大多数人对 USDT、USDC、RUSD 这样的美元锚定稳定币持接受态度。

可以说，**在 Fiber Network 上，闪电网络技术大规模被认可（ccBTC）、大规模被应用（RUSD）、汇聚 UTXO 生态共识（RGB++ Layer）第一次成为了可触达的目标。**

## **链上合约**

Fiber Network 目前采用 HTLC 保证安全性。借助 CKB 链的图灵完备性，之后会进一步扩展合约功能，比如引入基于版本号的撤销机制和更安全的资金锁定机制。

## **多跳路由**

Fiber Network 基于 Dijkstra 算法设计，允许支付方通过路由模块自动寻找最优路径，无需用户手动探索现有通道。回到前文的例子中，你的朋友无需知道你和超市老板的通道存在，他只需要向天大喊 “我要买瓶水”，老天爷自会指引完成购买流程。

## **监控服务**

Fiber Network 中，通道内的交易由 HTLC 保障安全，而通道本身的创建、打开、关闭由监控服务保障安全。类比而言，如果你发现超市的账本上多出了几笔花费，那多半会调取店内监控，检查老板是否在不该记录的时候恶意记录，维护自身权益。

## **当前进展和计划**

目前，Fiber Network 已经实现了两个节点之间的通道的创建、更新和关闭的基本功能，同时也验证了和比特币闪电网络的跨链功能。接下来将完成多跳路由和监控服务，并允许更多开发者接入。此外，通过 CKB 的可编程性实现隐私保护算法，并基于此优化路由算法和监控服务，保护用户支付信息的安全和隐私等也在计划之中。

## **未来展望**

当我们建立了如此出色的闪电网络之后，如何应用、如何落地便成为了下一步思考的方向。除了每当提及闪电网络就必然提起的线下支付领域以外，闪电网络还有多样的应用潜力，在所有满足 “高交互”、“多对象” 的应用情境中，闪电网络都可以有一席之地。本文且暂举几个例子，抛砖引玉。

1. **DePIN**，即 “去中心化物理基础设施网络”。DePIN 设备将区块链与现实世界的基础设施相结合，其中涉及大量的数据传输、资源共享的数据交换和小额交易，且 DePIN 设备的数量越多意味着区块链网络的负载越高，闪电网络在解决这些问题的同时还提供了 DePIN 设备一定的跨链能力。据悉，CKB 近期也在 DePIN 项目上做出了重大突破，可以期待一下。
2. **P2P 链上信息传输。**对于区块链技术的信徒而言，与其用 “去中心化” 一词，“Peer to Peer” 更能准确表述他们的追求。传统的信息传输、下载手段的实践已经表明了 P2P 模式在效率上的优势，而闪电网络 “通道”、“多跳路由” 的构造恰好满足了在区块链世界中进行 P2P 传递的需求，高效完成信息传递的同时还可以保障信息的安全性。
3. **GameFi。**在 Web3 游戏中，有些游戏涉及十分频繁的与智能合约的链上交互，不断地点击授权验证极大影响了游戏体验。如果引入闪电网络，开局时建立通道，结算时关闭通道并进行链上结算，这样的技术加持让在全链游戏中获得沉浸式体验成为了可能。

## **结语**

当堡子第一天来到 CKB 生态时，不认识什么 Cipher，也不知道什么老王，他们仿佛离我很远，隐匿在自己的世界里。后来，从红极一时的 “你XX谁啊” 开始，从和 CKB 生态的 OG 深入交流，窥探群里大佬们的讨论开始，Cipher、张韧、Jan、Daniel、knwang、Quake 等等 CKB 技术大佬们在我脑海里的形象一点点丰满了起来。

他们有几分 nerd 也带着几分狂，坚持自己的原则到固执得有些令人头大；他们不求尽善尽美，但求无愧于心。他们会犯错也会反思，为技术骄傲更对技术敬畏。CKB 的六年里，他们挺过了深熊，挺过了减半，哪怕饱受社区抨击他们也绝不另起门户，永远坚持去中心化、散户共享的区块链精神，始终沉醉于区块链的无穷魅力之中。

今天，透过这篇轻皮书的字里行间，我仿佛能看到一个个青涩的少年，脸上带着些许胆怯和不安，却又藏不住内心的自豪。他们小心翼翼地捧着那颗四年来精雕细琢、潜心打磨的璀璨明珠，怀着雀跃的心情向前走去，渴望亲手将它镶在爱人的皇冠之上。

理想的光，洒落在前方。